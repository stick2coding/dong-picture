## 什么是CDN

CDN（内容分发网络）是通过将图片文件分发到全球各地的节点，用户访问时从离自己最近的节点获取资源的技术，

常用于文件资源或后端动态请求的网络加速，也能大幅分摊源站的压力、支持更多请求同时访问，是性能提升的利器。


CDN 请求的核心过程如下：

图片文件由 源站（如 COS 对象存储、或者服务器）上传至 CDN 服务进行缓存。

当用户请求图片时，CDN 会根据用户的地理位置，返回离用户 最近的 CDN 节点缓存的图片资源。

未命中缓存的图片将从源站获取，并缓存在 CDN 节点，供后续用户访问，俗称 回源。

回源的具体解释：在内容分发网络中，回源是指用户通过浏览器发送请求时，响应该请求的是源站点的服务器，而不是各节点上的缓存服务器。

一般情况下，当 CDN 节点上的缓存服务器没有缓存响应的内容，或者响应的内容在源站点服务器上被修改，就会回源站去获取。

## 优势

从这两个服务的名称中，我们就能明显感受到区别了，COS 更倾向于 “存储”，CDN 更倾向于 “网络请求”。

所以如果文件存储容量较大、但是访问频率较低，用对象存储性价比更高；

但如果资源访问频率高、流量消耗大，还需要对访问进行加速、减少源站压力，就要使用 CDN 了。

CDN 的流量和请求单价通常低于对象存储，而且更加安全，可以保护源站地址不被泄露。

## 使用

COS 作为源站，负责存储图片文件；CDN 负责提供文件访问服务，以及缓存、安全性的设置。

也就是说，使用 CDN 之后，我们数据库中存储的图片地址就不再是 COS 的地址，而是 CDN 的 URL。


缓存策略：为静态资源（如图片、CSS、JS）设置长期缓存时间，可以减少回源的次数和消耗。

防盗链：配置 Referer 防盗链保护资源，比如仅允许自己的域名可以加载图片

IP 限制：根据需要配置 IP 黑白名单，限制不必要的访问。

HTTPS 配置：配置有效的 SSL 证书，启用 HTTPS 传输，提高请求的安全性。

**监控告警：这点尤为重要！** 一定要给 CDN 配置监控告警

比如设置一段时间内最多消耗的流量，超出时会自动发短信告警，避免费用超额；
或者限制单个 IP 的请求频率，防止突发流量影响服务。

CDN 节点选择：国内业务选择覆盖中国大陆的节点就足够了，非必要的话，不要开通全球 CDN 节点，容易遭受海外攻击。

访问日志：开启访问日志，分析用户行为和流量来源，这个能力更适合业务访问量较大的场景。