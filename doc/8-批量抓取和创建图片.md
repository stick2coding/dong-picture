## 需求

为了帮助管理员快速丰富图片库,冷启动项目,需要提供批量从网络抓取并创建图片的功能

**但是要注意,不建议将该功能开放给普通用户!**

主要是为了防止滥用导致的版权问题、低质量内容 的上传、服务器资源消耗和安全问题。

因为我们要从网络批量抓取图片(爬虫),如果功能开放给用户,
相当于所有用户都在使用我们的服务器作为爬虫源头,容易导致我们的服务器IP被封禁。

### 从哪里抓图片

绝大多数的图片素材网站,都是有版权保护的,不建议大家操作,容易被封禁IP和账号。

比较安全的方法是从搜索引擎中抓取图片,仅学习使用、不商用的话基本不会有什么风险。

### 如何抓取搜索引擎中的图片


有2种常见的做法,

第一种是请求到完整的页面内容后,对页面的HTML结构进行解析,提取到图片的地址,再通过URL下载;

还有一种是直接调用后端获取图片地址的的接口拿到图片数据。


要使用哪种方式,还是要具体情况具体分析,比如在调研过程中,我们会发现直接从bing图片的首页抓取数据,可能会出现获取不到图片的情况。

所以我们换一种策略,尝试去找图片接口。

按F12打开网络请求控制台,向下滚动图片时会触发新一波图片的的加载,就能看到获取图片数据的接口了

接口：https://cn.bing.com/images/async?q=%s&mmasync=1

注意,URL地址必须要添加mmasync=1参数!否则加载条数不对

但是该接口返回的还是HTML文档结构,所以我们需要使用一个HTML文档解析库来提取图片地址,

Java中比较推荐jsoup,非常地轻量。

jsoup支持使用跟前端一致的选择器语法来定位HTML的元素,比如类选择器、CSS选择器。

我们可以先通过类选择器找到最外层的元素dgControl,再通过CSS选择器imgmimg找到所有的图片元素


注意,图片的地址后面有很多附加参数,比如?w=199&h=180,在导入图片时一定要移除!

否则会影响图片的质量,还有可能导致上传到对象存储的文件包含被转义的特殊字符,引发无法访问等问题。

### 规则

管理员输入搜索关键字和抓取数量等参数

数量一次不建议超过30

## 使用

### 引入 jsoup 库

```xml
<!-- HTML 解析：https://jsoup.org/ -->  
<dependency>  
    <groupId>org.jsoup</groupId>  
    <artifactId>jsoup</artifactId>  
    <version>1.15.3</version>  
</dependency>

```
