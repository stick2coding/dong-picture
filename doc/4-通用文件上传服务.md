## 分析
通用的对象存储操作类 CosManager，但这个类并不能直接满足我们的图片上传需求。

比如：

- 图片是否符合要求？需要校验 
- 将图片上传到哪里？需要指定路径 
- 如何解析图片？需要使用数据万象服务

所以，可以针对我们的项目，编写一个更贴合业务的文件上传服务 FileManager（这里用 Service 也可以），
该服务提供一个上传图片并返回图片解析信息的方法。


### 代码

具体见FileManager.java类

用到了数据万象服务


- 由于文件校验规则较复杂，单独抽象为 validPicture 方法，对文件大小、类型进行校验。 
- 文件上传时，会先在本地创建临时文件，无论上传是否成功，都要记得删除临时文件，否则会导致资源泄露。 
- 可以根据自己的需求定义文件上传地址，比如此处鱼皮给文件名前增加了上传日期和 16 位 uuid 随机数，便于了解文件上传时间并防止文件重复。还预留了一个 uploadPathPrefix 参数，由调用方指定上传文件到哪个目录。


### 测试
使用 Swagger 进行测试，发现当上传图片过大时，会触发一段报错。
但这个报错不是我们自定义的异常导致的，
而是由于 Tomcat 服务器默认限制了请求中文件上传的大小。

需要在 application.yml 中更改配置，调大允许上传的文件大小

```yml
spring:  
  # 开放更大的文件上传体积  
  servlet:  
    multipart:  
      max-file-size: 10MB

```